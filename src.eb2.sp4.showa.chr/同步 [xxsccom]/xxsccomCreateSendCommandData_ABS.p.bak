/* SS - 091030.1 By: Neil Gao */
/* SS - 091105.1 By: Lambert */
/* SS - 091122.1 By: Neil Gao */

/* SS 091122.1 - B */
/*
增加abs_user1 来标记同步
*/
/* SS 091122.1 - E */

/* SS 091105.1 - B */
/*
修正没有文件头的错误
*/
/* SS 091105.1 - E */

{mfdeclre.i}

DEFINE INPUT PARAMETER vend AS CHARACTER.
DEFINE INPUT PARAMETER vend1 AS CHARACTER.
DEFINE INPUT PARAMETER nbr AS CHARACTER.
DEFINE INPUT PARAMETER nbr1 AS CHARACTER.

DEFINE INPUT-OUTPUT PARAMETER requestFileName AS CHARACTER.

DEFINE VARIABLE id AS INTEGER.
DEFINE VARIABLE idrec AS RECID.
DEFINE VARIABLE indent AS INTEGER.

IF requestFileName = "" THEN DO:
   {gprun.i ""xxsccomGetRequestFileName.p"" "(
      OUTPUT requestFileName
      )"}
END.
define var homedir as char format "x(32)".
input through echo $HOME no-echo.
set homedir.
requestFileName =  homedir + requestFileName.
OUTPUT TO VALUE( requestFileName).
/* SS 091105.1 - B */
/* <root> */
{gprun.i ""xxsccomCreateSendCommandData1b.p""}
/* SS 091105.1 - E */
put "  <service>shpMstrSyncViSrv</service>" skip.
put "  <function>receivingSync</function>" skip.
put "  <command>save</command>" skip.

/* <datas> */
put "  <datas>" skip.
/* <table> */
put "    <table entityName=" """" "com.ss.shp.domain.ShpMstrEn" """" ">" skip.

id = 0.
indent = 3.

for each abs_mstr where abs_shipfrom >= vend and abs_shipfrom <= vend1
	and abs_id >= "S" + nbr and abs_id <= "S" + nbr1 
	and abs_type = "r" and substring(abs_status,2,1) = "Y"
/* SS 091122.1 - B */
/*
	no-lock:
*/
	and abs_user1 = "" :
/* SS 091122.1 - E */
	put unformat "      <record>" skip.
	put unformat "        <abs_id>"  ''''  +  substring(abs_id,2) + '''' "</abs_id>" skip.
	put unformat "        <abs_shipfrom>" '''' + abs_shipfrom + '''' +  "</abs_shipfrom>" skip.
	put unformat "        <comment>" '''' + abs__chr01 +  ''''  "</comment>" skip.
	put unformat "      </record>" skip.
end.

/* </table> */
{gprun.i ""xxsccomCreateSendCommandData3e.p""}

/* </datas> */
{gprun.i ""xxsccomCreateSendCommandData2e.p""}
/* </root> */
{gprun.i ""xxsccomCreateSendCommandData1e.p""}
