/* ss - 100611.1 by: jack */
/* display title */
/* ss - 100423.1 by: jack */
/* ss - 100714.1 by: jack */
/* ss - 100729.1 by: jack */
/* ss - 100809.1 by: jack */
/* ss - 101208.1  by: roger xiao */  /*直接修改格式,并所有删除ECO信息,重排程式格式*/
 {mfdeclre.i}
 {gplabel.i}

 {xxricrt1var1.i}

define variable mm as integer format ">>9".
define variable page-start as integer .
define variable desc1 like pt_desc1 .
define var v_desc1 like pt_desc1 .
define buffer ptmstr for  pt_mstr .

define variable companyname  as char format "x(28)".
define variable xdnname      like xdn_name.
define variable xdnisonbr    like xdn_isonbr.
define variable xdnisover    like xdn_isover.
define variable xdntrain1    like xdn_train1 .
define variable xdntrain2    like xdn_train2 .
define variable xdntrain3    like xdn_train3 .
define variable xdntrain4    like xdn_train4 .
define variable xdntrain5    like xdn_train5 .
define variable xdnpage1    like xdn_page1 .
define variable xdnpage2    like xdn_page2 .
define variable xdnpage3    like xdn_page3 .
define variable xdnpage4    like xdn_page4 .
define variable xdnpage5    like xdn_page5 .
define variable xdnpage6    like xdn_page6 .

define var v_rsn as char .
define var v_method as char format "x(12)" .

define var v_page_bottom as integer . /*页尾留多少行*/

v_page_bottom = 17.

form
    header       
    "BG-SC-09"       at 1  
    companyname        at 30	 
    "日期:" at 66
    today          skip
    xdnname                         at 33
    "原因:"    at 66
    v_rsn
    "单号:"                at 1
    rcvno       
    "方法:"   at 66
    v_method
    "项次 线体 工单/id          零件号码      描述                          领料数  退料数 实退数 原因描述         责任部门"  at 1 
    "-------------------------------------------------------------------------------------------------------------------------" at 1 
with frame phead1 page-top width 130  no-box.

 
        find first ad_mstr  
            where ad_mstr.ad_domain = global_domain 
            and  ad_addr =  global_domain 
            and ad_type = "company" 
        no-lock  no-error.
        if available ad_mstr then companyname = ad_name. else companyname = "sincere-home".

        find first xdn_ctrl where xdn_ctrl.xdn_domain = global_domain and xdn_type = "rt"  no-lock no-error.
    	if available xdn_ctrl then do:
        	   xdntrain1 = xdn_train1.
        	   xdntrain2 = xdn_train2.
        	   xdntrain3 = xdn_train3.
        	   xdntrain4 = xdn_train4.
        	   xdntrain5 = xdn_train5.
        	   xdnpage1 = xdn_page1.
        	   xdnpage2 = xdn_page2.
        	   xdnpage3 = xdn_page3.
        	   xdnpage4 = xdn_page4.
        	   xdnpage5 = xdn_page5.
        	   xdnpage6 = xdn_page6.
        	   xdnname   = xdn_name.
        	   xdnisonbr = xdn_isonbr.
        	   xdnisover = xdn_isover.
    	  
    	end. 
    	else do:
        	message "退料单格式没有设置, 请重新设置后再打印!!"  .
        	undo, retry.
    	end.
   
        /* ss - 100623.1 -b */
        find first xxrt_det  no-lock where xxrt_domain = global_domain and xxrt_nbr = rcvno  no-error .
        if available xxrt_det  then  do:
            v_rsn = xxrt_rsn .
            find first code_mstr 
                where code_domain = global_domain 
                and code_fldname = "xxrt"
                and code_value = xxrt_method 
            no-lock no-error .
            if available code_mstr  then
            v_method = code_cmmt .
        end.
     
        view frame phead1.
        mm = 1.
        page-start = 1.
   
for each xxrt_det 
        use-index xxrt_line 
        where xxrt_det.xxrt_domain = global_domain 
        and xxrt_nbr = rcvno  
        no-lock ,
    each pt_mstr 
        where pt_mstr.pt_domain = global_domain 
        and pt_part = xxrt_wodpart 
        no-lock 
    with frame c down width 85 no-box:
   
    if mm = 1 then do:
        find first loc_mstr where loc_mstr.loc_domain = global_domain and loc_site = xxrt_site_from
        and loc_loc = xxrt_loc_from no-lock no-error.
        if available loc_mstr then assign prodline = loc_loc
                                     proddesc = loc_desc.
        else assign prodline = xxrt_loc_from 
                               proddesc = "".

        view frame phead1.  
              
    end.
       

    desc1 = pt_desc1  + "  " + pt_desc2  .
 
    if page-size - line-counter <    v_page_bottom then do:    
  
        put "-------------------------------------------------------------------------------------------------------------------------" at 1 skip .
                           
        put "填写:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _   核实:_ _ _ _ _ _ _ _ _ _ _ _ _ _    审核:_ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
        put "处理意见:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _            仓库:_ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
        put "PQC     :_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
        put "品管审核:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
        put "采购部  :_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
        put "技术/工程部:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
        put "PMC部   :_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"  .


        put "page: "    at 106  string(page-start) format "xxxx"   skip  .
        page-start = page-start + 1.
                
        page .
        view frame phead1 .
     
    end. /*if page-size - line-counter */
    
    put xxrt_line  format ">>9" at 1 .
    put xxrt_wonbr    + "/" + xxrt_wolot  format "x(14)"  at 11 .
    put xxrt_wodpart    format "x(14)" at 28 .
    put desc1  format "x(30)" at 42 .
    put string(xxrt_relqty)     at 72 .
    put  string(xxrt_qty_from ) at 83 .
    put xxrt_remark format "x(27)" at 94.

    if page-size - line-counter >    v_page_bottom  then    
        put "-------------------------------------------------------------------------------------------------------------------------" at 1  skip.
    if page-size - line-counter  =   v_page_bottom then  put skip(1) .

    mm = mm + 1.
    {mfrpchk.i}
end. /* for each   ... */

 
put skip(page-size - line-counter - (v_page_bottom - 2) ) . 
put "-------------------------------------------------------------------------------------------------------------------------" at 1 skip  .         	       
put "填写:_ _ _ _ _ _ _ _ _ _ _ _ _ _    核实:_ _ _ _ _ _ _ _ _ _ _ _ _ _    审核:_ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
put "处理意见:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _            仓库:_ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
put "PQC     :_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
put "品管审核:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
put "采购部  :_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
put "技术/工程部:_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ " skip.
put "PMC部   :_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ "  .

put "page: "    at 106 string(page-start) format "xxxx". 
put "(end)" . 
page-start =  1.

