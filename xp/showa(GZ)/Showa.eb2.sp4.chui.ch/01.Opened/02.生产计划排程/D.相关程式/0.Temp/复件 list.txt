









err_det   /*错误信息汇总*/
nr_det    /*纳入明细*/
kc_det    /*理论库存*/
xrq_det   /*排程时间点的可用容器数量*/
xln_det   /*每个零件的主产线*/

xcn_det   /*产线每日可用产能*/
ttemp1    /*本次排程,每个产线的最优生产顺序*/
ttemp2    /*本次排程,每个产线的最优生产顺序*/

记录每天的容器耗用,剩余产能
记录每个月,每天的加班,可加班



产线加减机种,则重算生产顺序和产能




按平均值的经济批量初排,
    记录每天的产能耗用,剩余
判断产能,容器等,
    以经济批量为单位加减
    换线(重算最优组合),加班
    提前生产


    
产能,容器:
    在产能不足，容器足够的情况下：按照已排机种的生产顺序，从低层往高层，逐步减少排程数量，但每个机种排程后的理论库存不能低于库存基准下限；
 	在产能不足，容器足够的情况下：按照已排机种的生产顺序，从低层往高层，逐步减少排程数量，减少到排程点所有机种排程后的理论库存都处于库存基准下限产能亦不足，则安排加班；如果法定加班时间已用完，则将排程数量停留在排程点
 	在产能不足，容器也不足够的情况下：在每个机种排程后的理论库存不能低于库存基准下限的前提下按照可用容器收容总量进行排程

 	产能足够且容器足够的情况下，按照库存基准平均值线进行排程，还有产能富余的，首先应考虑未来节点是否会有加班，如果有加班的，则将加班的提前到产能富余节点安排生产
 	产能足够且容器足够到库存上限的情况下，按照库存基准平均值线进行排程，还有产能富余的，首先应考虑未来节点是否会有加班，如果无加班的，按照已排机种的生产顺序，从高往低提高可排程数量，直至库存上限基准线。
 	产能足够且容器不足够到库存上限的情况下，按照库存基准平均值线进行排程，还有产能富余的，首先应考虑未来节点是否会有加班，如果无加班的，按照已排机种的生产顺序，从高往低提高可排程数量，直至可用容器收容总量为止。
 	产能足够，但容器不足到库存下限的情况下，则按照库存下限基准线安排生产排程，空余产能在其他容器足够的前提下，将后续节点需要加班的其他机种提前到此节点生产
 	
 	排程结果按照库存上限排程仍有产能富余的，则将后续生产日的排程提前到产能空余日排程
    



经济批量:
    首先按照库存结余为库存平均值的数量安排排程，
    排程数量如果不能整出排程经济批量，则拔高库存进行排程，如果拔高库存排程超过库存上限，按照超过库存上限值的经济批量排程
    如果可排程数量按照经济批量圆整，加则超过上限，减不会低于零库存下限，则按照减后的排程数量进行排程，

	如果按照库存下限排程的，也必须满足经济批量条件进行排程，即：如果只能按下限排程的，亦必须满足经济批量的条件
	

主生产线:
    如果MHSDA3-0N1-1-06可在HPS和HPS01生产线上同时生产，而HPS为主生产线
    首先安排主生产线HPS生产，如果HPS当日安排生产后且已经排满，该物料还有剩余量未排产，
    则查看生产线HPS其他日是否有剩余时间可以安排，如果有则安排在生产线HPS上生产，
    如果没有则开始查看HPS01上是否有剩余产能可以排程，如果有则安排到HPS01上进行生产，
    如果也没有，则安排到HPS上进行加班生产。

加班:
    在自动排程程序安排班外加班，应在国家法定加班时间范围内 
 	如果当前产能不足，需要安排提前加班生产的，则把两日中具有相同机种的产品安排加班。

    在产能不足，容器足够的情况下:排程点所有机种排程后的理论库存都处于库存基准下限产能亦不足，则安排加班；如果法定加班时间已用完，则将排程数量停留在排程点




SP排程
 	量产件与SP件之间的换机种时间需要被考虑到排程
 	零件状态为SP的，不按库存基准进行计算，而是按照纳入量及提前期直接进行排程
    SP排程一定是在量产件排程之后，维修件进入排程系统中的数量不考虑库存基准

 	当前周排程SP件：是排程当前周后第二周所有的SP件订单，并将数量汇总到当前周后的第一周,进行顺排程，
    如果节点的产能不足以满足SP件订单的时候，需要依次减少其他量产件的计划，将量产件计划压缩至库存下限，且班后加班2小时后仍不足以安排SP件，则按照以上逻辑滚动排程；
    如果在第一周的某日量产件即能满足库存基准下限生产亦能将SP件数量完全排程的，则将SP件排程到那一日集中完成（可加班时间考虑在内）。










 	产品可排程数量=（库存基准下限+库存基准上限）/2+排程周节点销售纳入-排程周节点理论库存

 	排程周节点理论库存的推算是从系统当前日期开始滚动推算的，当前日期的理论库存=本日凌晨2点实际库存+未结进度工单-未结销售纳入；

 	如果在库存基准设定的天数内找不到纳入量，则往后顺延查找至第15天的非0纳入点，如果均无需求，则库存基准为0；如果在当前时点开始的15日内找到纳入点不为0，则从那一天开始继续按照库存基准计算，但不能查找第15日后的纳入
 	产品在排程后得到的理论库存首先应尽量等于库存基准平均值
 	生产计划更新程序：从当前周开始计算，当前日和后一日的执行生产计划不能被刷新（跨周的允许刷新），而后的计划将根据以上逻辑进行动态刷新
 	生产计划更新程序：每次进行更新时，如果上一版本的排程计划数量仍然能满足现有的纳入库存基准，那么新版本的计划数据将沿用上一版本的计划数据。

    
报错:     
    如果量产缺少换线时间或SP件缺少换线时间的，则按照'固定换线时间'进行考虑排程运算；但需要出现到报错文本
 	生产线班次维护，生产线产能维护，固定顺序维护，零件库存基准维护，容器设定出现遗漏数据的情况，那么生产计划更新程序在更新时，将报错，并在服务器生成错误文本，提供给昭和人员查看。






