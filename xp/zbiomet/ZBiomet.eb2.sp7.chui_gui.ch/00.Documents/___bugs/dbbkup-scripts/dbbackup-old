
# tokens:
# &DLC = Progress Directory
# &LOOP-DB-START = start of database loop
# &LOOP-DB-END = end of database loop
# &START-SERVER = command line to start current DB in database loop

DLC=/mfgeb2/progress/dlc91d;export DLC
PATH=$PATH:$DLC;export PATH
PROMSGS=$DLC/promsgs;export PROMSGS
PROTERMCAP=$DLC/protermcap;export PROTERMCAP

######### Shut donw production database #############
echo "shutdown production database, please wait..."
/mfgeb2/script/stop.Production > /mfgeb2/script/log/stopprd.log

######### Truncate Production Database ##############
echo "truncate  production database, please wait..."
$DLC/bin/_proutil /mfgeb2/eb2/db/biometprd -C truncate bi -G 30 > /mfgeb2/script/log/truncateprd.log
$DLC/bin/_proutil /mfgeb2/eb2/db/biometadm -C truncate bi -G 30 > /mfgeb2/script/log/truncateprd.log
$DLC/bin/_proutil /mfgeb2/eb2/db/biomethlp -C truncate bi -G 30 > /mfgeb2/script/log/truncateprd.log

######### Backup Production Database #################
echo "backup production database, please wait..."
$DLC/bin/probkup /mfgeb2/eb2/db/biometprd /mfgeb2/bkup/prd.bak > /mfgeb2/script/log/bkupprd.log
$DLC/bin/probkup /mfgeb2/eb2/db/biometadm /mfgeb2/bkup/admprd.bak > /mfgeb2/script/log/abkupprd.log
$DLC/bin/probkup /mfgeb2/eb2/db/biomethlp /mfgeb2/bkup/hlpprd.bak > /mfgeb2/script/log/hbkupprd.log

######### verify the backup #####################
echo "Verify production backup, please wait..."
$DLC/bin/prorest /mfgeb2/eb2/db/biometprd /mfgeb2/bkup/prd.bak -vf > /mfgeb2/script/log/prdbk.log
$DLC/bin/prorest /mfgeb2/eb2/db/biometadm /mfgeb2/bkup/admprd.bak -vf > /mfgeb2/script/log/aprdbk.log
$DLC/bin/prorest /mfgeb2/eb2/db/biomethlp /mfgeb2/bkup/hlpprd.bak -vf > /mfgeb2/script/log/hprdbk.log

######## Start Producion Database ###################
echo "start production database, please wait..."
/mfgeb2/script/start.Production > /mfgeb2/script/log/startprd.log

# Backup offline database from HD directory to tape  ###########
echo "copy backup files to tape, please wait..."
cd /
tar cvf /dev/nst0 ./mfgeb2/bkup  > /mfgeb2/script/log/backtotape.log
mt -f /dev/nst0 rewoffl
