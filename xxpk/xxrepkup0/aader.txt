送料单
open = 本次累计需求 - 车间库存 +  ∑(未确认送料单) - ∑(已送料单未回报工单需求量) 
sendqty = openqty - 多余数量

+++++++++++++++++++++++++++++++++
first-of(pt_part)
可用数量=车间库存数量+∑(未确认送料单)-∑(未回报工单数量)
else
可用数量=上期送料多余量

需求量=本次累计需求数量-可用数量
待发量=圆整(需求量)
送料多余量=待发数量-需求量
++++++++++++++++++++++++++++++++++

取料单
open = 备料区库存 - 备料多余库存 + ∑(未确认备料单) - ∑(未确认送料单) 
allqty = openqty - 多余数量
if first-of(pt_part)
可用数量=备料区库存数量+∑(未确认备料单量)-∑(未确认送料单量)
else 
可用数量=上期多余量

需求量=本期送料单待发数量-可用数量
待发量=圆整(需求量)
多余量=待发量-需求量